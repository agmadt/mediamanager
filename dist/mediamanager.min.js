!function(a,b){var c="Mediamanager";"function"==typeof define&&define.amd?define([],b(c)):"object"==typeof exports?module.exports=b(c):a[c]=b(c)}(this,function(a){"use strict";function A(a){this.options=d(c,a),this.element=document.createElement("div");var g=(document.querySelector("#"+this.options.wrapperId),document.querySelectorAll(".mediamanager-wrapper").length);0==g?this.element.setAttribute("id",this.options.wrapperId):this.element.setAttribute("id",this.options.wrapperId+g+1),document.getElementsByTagName("body")[0].appendChild(this.element),this.loadedItemsArray=[],this.selectedItemsArray=[],this.isDropzone=!1,this.Dropzone=null,window.Dropzone&&(this.isDropzone=!0),e.call(this),f.call(this)}var c={buttonText:"Insert to Post",loadItemsUrl:null,loadNextItemsUrl:null,loadNextItemsObject:{},loadNextItemDelay:3e3,deleteButtonText:"Delete",deleteConfirmationText:"Are you sure?",deleteItemUrl:null,uploadUrl:null,wrapperId:"mediamanager",insertType:"OBJECT",insert:function(){}},d=function(a,b){var d,e={};for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(e[d]=c[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(e[d]=b[d]);return e},e=function(){var a=document.createElement("div"),b=document.createElement("div"),c=this;x.call(this);var d=z.call(this),e=y.call(this);if(a.classList.add("mediamanager__content-wrapper"),a.appendChild(d),a.appendChild(e),this.element.classList.add("mediamanager-wrapper"),this.element.appendChild(a),this.options.uploadUrl){if(b.classList.add("mediamanager__upload-wrapper"),b.classList.add("--hidden"),this.isDropzone){Dropzone.autoDiscover=!1;var f=document.createElement("form");b.appendChild(f),f.setAttribute("action","/"),f.classList.add("dropzone"),this.Dropzone=new Dropzone(f,{url:this.options.uploadUrl,init:function(){this.on("success",function(a,b){c.Dropzone.removeAllFiles(),c.element.querySelector(".mediamanager-header__button").click();var d=JSON.parse(b);c.loadedItemsArray.push(d),l.call(c,d,c.loadedItemsArray.length-1,!0)})}})}this.element.appendChild(b)}this.options.loadItemsUrl&&h.call(this),w.call(this)},f=function(){var a=this;if(a.options.loadNextItemsUrl&&(a.element.querySelector(".mediamanager-content__items-wrapper").onmouseover=function(b){var c=this;c.classList.contains("--unloadable")||i.call(a,c),a.loadedItemsArray.length>14&&(c.onmouseover=null)},a.element.querySelector(".mediamanager-content__items-wrapper").onscroll=function(){var b=this;b.scrollHeight-b.scrollTop!==b.clientHeight||b.classList.contains("--unloadable")||i.call(a,b)}),a.element.addEventListener("click",function(b){var c=b.target.parentNode,d=c.getAttribute("object-id");if(b.target.classList.contains("mediamanager-item__delete-button")){return confirm(a.options.deleteConfirmationText)&&u.call(a,c,d),!1}c.classList.contains("mediamanager__item")&&(c.classList.contains("--selected")?(c.classList.remove("--selected"),p.call(a,d)):(c.classList.add("--selected"),a.selectedItemsArray.push(a.loadedItemsArray[d])),v.call(a))}),a.element.querySelector(".mediamanager-content-footer__insert-to-post-button").addEventListener("click",function(){for(var b=g.call(a),c=0;c<b.length;c++){var d=null;d="string"!=a.options.insertType||"html"!=a.options.insertType?n.call(a,a.options.insertType,b[c]):b[c],a.options.insert(d)}A.prototype.close.call(a)}),a.isDropzone&&this.options.uploadUrl){var b=a.element.querySelectorAll(".mediamanager-header-left__item");b.forEach(function(c,d){c.addEventListener("click",function(){b.forEach(function(b,c){var d=b.getAttribute("target");b.classList.remove("--selected"),a.element.querySelector(d).classList.add("--hidden")});var d=this.getAttribute("target");this.classList.add("--selected"),a.element.querySelector(d).classList.remove("--hidden"),c.classList.contains("mediamanager-header__upload-button")&&r.call(a)})})}a.element.querySelector(".mediamanager-header-right__item-clear-selected").addEventListener("click",function(){r.call(a)}),a.element.parentNode.querySelector(".backdrop-layer").addEventListener("click",function(){A.prototype.close.call(a)}),document.addEventListener("keydown",function(b){27==b.keyCode&&a.mediaManagerActive&&A.prototype.close.call(a)})},g=function(){for(var a=[],b=0;b<this.selectedItemsArray.length;b++)a.push(this.selectedItemsArray[b]);return a},h=function(){var a=new XMLHttpRequest,b=this;a.open("GET",b.options.loadItemsUrl,!0),a.onload=function(){if(a.status>=200&&a.status<400){b.loadedItemsArray=JSON.parse(a.responseText);for(var c=0;c<b.loadedItemsArray.length;c++)l.call(b,b.loadedItemsArray[c],c)}else console.log('"initial load items ajax error" - We reached our target server, but it returned an error')},a.onerror=function(){},a.send()},i=function(a){a.classList.add("--unloadable"),setTimeout(function(){a.classList.remove("--unloadable")},this.options.loadNextItemDelay),j.call(this)},j=function(){var a=new XMLHttpRequest,b={totalItems:this.loadedItemsArray.length,custom:this.options.loadNextItemsObject},c=null,d=this;c=k(b).slice(0,-1),a.open("POST",this.options.loadNextItemsUrl,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.onload=function(){if(a.status>=200&&a.status<400){var b=JSON.parse(a.responseText);if(Array.isArray(b))for(var c=0;c<b.length;c++)l.call(d,b[c],d.loadedItemsArray.length-1),d.loadedItemsArray.push(b[c]);else console.log('Data loaded from "next item loaded" must be an array.')}else console.log('"next item loaded ajax error" - We reached our target server, but it returned an error')},a.send(c)},k=function(a){var b="";for(var d in a)"object"==typeof a[d]?b+=k(a[d]):(b+=d+"="+a[d],b+="&");return b},l=function(a,b,c){var d=this,g=null,h=null,i=document.createElement("div"),j=document.createElement("div"),k=d.element.querySelector(".mediamanager-content__items-wrapper");g=document.createElement("img"),h=document.createElement("div"),h.classList.add("mediamanager__item"),h.setAttribute("object-id",b),h.appendChild(g),i.classList.add("mediamanager-item__layer"),h.appendChild(i),this.options.deleteItemUrl&&(j.classList.add("mediamanager-item__delete-button"),j.innerHTML=this.options.deleteButtonText,h.appendChild(j)),m(g,a),c?k.insertBefore(h,k.firstChild):k.appendChild(h)},m=function(a,b){var c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAUVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABcqRVCAAAAGnRSTlMAAgkQGyAwUF9gb3Cfr7C0vL/Az9Df7/D19lwfg1sAAADzSURBVHja7dhBD4IwDIbhanU60YGgoP3/P9TERJtAwLJ9Bw99z8sDY5QD9Ol4EWvXE9OvWDlL/ekXqJ6xLix6UVbXxyUwSUZnngffCw5kS7fNy2toLSj3AAalDzAwqogBKQx62BCQ9jd5F1Eg8U13DQFVRIEqYkAV74wBVewYA6p4hoG0H/TlgYAU9GAAoH5Mu0JwWoUGewaDUuWC7QzY5oKcZsQJWJCDDjro4F+Au1oM1Tsz2IipxgpunzbwsUHfIfwZ+nvok+KT4pPik+KT4pPioIP54CHfi2MwCaA0uUJhkbC3mCZ/Ogo9Hj/XVMR9T/QFzO/QVRK6AysAAAAASUVORK5CYII=",d=s(b),e="",f="";if(b.path&&(e=b.path),b.filename&&(f=b.filename),b.filetype&&(d=b.filetype),"image"==d?(c=e+f,b.display_file&&(c=e+display_filename)):"music"==d?c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAATlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADEoqZZAAAAGXRSTlMAECAwP0BQX2BvcH+An6CvsL/Az9Df4O/wsv/mkQAAAWxJREFUeAHt2M1ugzAQxPG13abOtw0FOu//olVL9xKLCdmslB74n9HPaOACon1csba6D3KvwLi2aX8PXO1pfaJexsNNmYEFhs5kSfy0k3VB6wO/Rh4FMSRnEFNyAzMVDaCkr1nMXqDET/yWvUAJszglH5CINpCIdlDFIXiBKvbBC1Tx7AZKnN/H7AZK0gfjBUqeZ3wSbDt4g1NwBnGwgt0C2FnBUBbEFrS3gS8Hw9vxOqBGM9hYc8UKNpZmABvLDHLLDsYKkgGscAbx1waOxQNU6/QeRBxAtebsYGM5gGq5gaJt4H8E47FOQF/30QVMFRo8wAy4ghm+YIQFJNtfTCDZfjCBZHuYQLL9iKaRg2T7hQ0vHCTbL5wUKUi2X9giyxqQbJ8XPA6y7VMHDV0SBq7dPp66ERi7UxThIN+eRECyvQFk25tBsr0V5Ntvn2YvAHd2L9+CBQ6V5oQny+J7i4X86TB54XbXp8iyU+cbUl3m0Vv4Iq8AAAAASUVORK5CYII=":"video"==d&&(c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAaVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnbPKNAAAAInRSTlMAAQgQGyApMENQWF9gbm9wkJ+nqK+wvL/Az9DW3+Tv8Pf+c7NfdwAAAT1JREFUeAHt2FFTglAQxfGtzYi6aVK3xAxrv/+HbGrmPEQD4vU/jg+cZ+cnwmFZMeXhJabmbel2KD6NU7rlIVDe5LTVqJfi6HRpDMxRkLUPg/GT2qYllNbHP2PHgrGrYDC6CgOTRAq0aq+LDYG22MZvEgWab/WrEbAnAmBPRECJO6dAia1ToMQ1Btpir/JAoFW6MBCoYdqeCP7PigY7h8FYlYKbAXBTCnoeEAfAoszgGcHGYTA+7mAwvp6uWTDi/RYG4/PxigUjXm9gMLp7DFQah0EViANVIA5UgUBQBeJAFQgEVSAOVIFAUAXiQBWIAJVn/Agv+hw2DveQvlPoexmeNvQ8vOiJ3Tj/1OOfy/zmwO82/PbF74fwBjv/C5jBGazLvdQHcwDJf74BSDL2EPPIm44iz/vnNZ/E1XK+AWBw/UVvlPBrAAAAAElFTkSuQmCC"),a.setAttribute("src",c),"image"!=d){var h=a.parentNode,i=document.createElement("div");i.classList.add("mediamanager-item__filename-wrapper"),i.innerHTML=f,h.appendChild(i),h.classList.add("filetype")}},n=function(a,b){var c=s(b),d=document.createElement("a"),e="",f="";return b.path&&(e=b.path),b.filename&&(f=b.filename),b.filetype&&(c=b.filetype),d.setAttribute("href",e+f),d.setAttribute("target","_blank"),d.innerHTML=f,"string"==a&&(d='<a href="'+e+f+'" target="_blank">'+f+"</a>"),"image"==c&&(d=document.createElement("img"),d.setAttribute("src",e+f),"string"==a&&(d='<img src="'+e+f+'">')),d},p=function(a){var b=this.selectedItemsArray.indexOf(this.loadedItemsArray[a]);b>-1&&this.selectedItemsArray.splice(b,1)},q=function(a){this.loadedItemsArray.indexOf(this.loadedItemsArray[a])>-1&&this.loadedItemsArray.splice(a,1)},r=function(){for(var a=this.element.querySelectorAll(".mediamanager__item.--selected"),b=0;b<a.length;b++)a[b].classList.remove("--selected");this.selectedItemsArray=[],this.element.querySelector(".mediamanager-content__footer-wrapper").classList.remove("--active"),v.call(this)},s=function(a){var b=new RegExp("jpg|png|gif"),c=new RegExp("mp3|ogg|wav"),d=new RegExp("mkv|flv|ogv|avi|mov|wmv|mp4|3gp"),e=t(a.filename),f="etc";return b.test(e)?f="image":c.test(e)?f="music":d.test(e)&&(f="video"),f},t=function(a){return a.slice(2+(a.lastIndexOf(".")-1>>>0))},u=function(a,b){var c=new XMLHttpRequest,d={totalItems:this.loadedItemsArray.length,itemObject:this.loadedItemsArray[b]},e=null,f=this,g=this.element.querySelector(".mediamanager-content__items-wrapper");e=k(d).slice(0,-1),c.open("POST",this.options.deleteItemUrl,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.onload=function(){c.status>=200&&c.status<400?(p.call(f,b),g.removeChild(a),q.call(f,b),v.call(f)):console.log('"delete item error" - We reached our target server, but it returned an error')},c.send(e)},v=function(){this.element.querySelector(".item-counter-count").innerHTML=this.selectedItemsArray.length,this.selectedItemsArray.length>0?this.element.querySelector(".mediamanager-content__footer-wrapper").classList.add("--active"):this.element.querySelector(".mediamanager-content__footer-wrapper").classList.remove("--active")},w=function(){if(0==document.querySelectorAll(".backdrop-layer").length){var a=document.createElement("div");a.classList.add("backdrop-layer"),this.element.parentNode.appendChild(a)}},x=function(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("span"),h=document.createElement("div");a.classList.add("mediamanager__header-wrapper"),b.classList.add("mediamanager-header__left-wrapper"),d.classList.add("mediamanager-header-left__item"),d.classList.add("mediamanager-header__button"),d.classList.add("--selected"),d.setAttribute("target",".mediamanager__content-wrapper"),d.innerHTML="Mediamanager",this.isDropzone&&this.options.uploadUrl&&(e.classList.add("mediamanager-header-left__item"),e.classList.add("mediamanager-header__upload-button"),e.setAttribute("target",".mediamanager__upload-wrapper"),e.innerHTML="Upload"),c.classList.add("mediamanager-header__right-wrapper"),f.classList.add("mediamanager-header-right__item-counter"),f.innerHTML="Item selected:",g.classList.add("item-counter-count"),g.innerHTML="0",h.classList.add("mediamanager-header-right__item-clear-selected"),h.innerHTML="Clear Selected",b.appendChild(d),b.appendChild(e),c.appendChild(f),f.appendChild(g),c.appendChild(h),a.appendChild(c),a.appendChild(b),this.element.appendChild(a)},y=function(){var a=document.createElement("div"),b=document.createElement("div");return b.classList.add("mediamanager-content-footer__insert-to-post-button"),b.appendChild(document.createTextNode(this.options.buttonText)),a.classList.add("mediamanager-content__footer-wrapper"),a.appendChild(b),a},z=function(){var a=document.createElement("div");return a.classList.add("mediamanager-content__items-wrapper"),a};return A.prototype={open:function(){document.querySelector("body").classList.add("--mediamanager"),this.element.classList.add("--active"),this.element.parentNode.querySelector(".backdrop-layer").classList.add("--active"),this.mediaManagerActive=!0},close:function(){document.querySelector("body").classList.remove("--mediamanager"),r.call(this),this.element.classList.remove("--active"),this.element.parentNode.querySelector(".backdrop-layer").classList.remove("--active"),this.mediaManagerActive=!1}},A});